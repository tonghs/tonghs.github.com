---
author: ths
comments: true
date: 2012-07-23 11:42:00+00:00
layout: post
slug: cc%e4%bd%bf%e7%94%a8jni%e7%9a%84%e5%8c%ba%e5%88%ab
title: C/C++使用JNI的区别
wordpress_id: 828
categories:
- 技术
tags:
- c
- JNI
---

里使用JNI，总是报错  





    
    packages/apps/SystemMointor/jni/proc_reader.c:78: error: request <span class="kwrd">for</span> member <span class="str">'GetStringUTFChars'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:92: error: request <span class="kwrd">for</span> member <span class="str">'FindClass'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:94: error: request <span class="kwrd">for</span> member <span class="str">'NewObjectArray'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:96: error: request <span class="kwrd">for</span> member <span class="str">'FindClass'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:98: error: request <span class="kwrd">for</span> member <span class="str">'GetFieldID'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:99: error: request <span class="kwrd">for</span> member <span class="str">'GetFieldID'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:108: error: request <span class="kwrd">for</span> member <span class="str">'SetObjectField'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:108: error: request <span class="kwrd">for</span> member <span class="str">'NewStringUTF'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:116: error: request <span class="kwrd">for</span> member <span class="str">'SetObjectField'</span> <span class="kwrd">in</span> something not a structure or union
    packages/apps/SystemMointor/jni/proc_reader.c:118: error: request <span class="kwrd">for</span> member <span class="str">'SetObjectArray'</span> <span class="kwrd">in</span> something not a structure or union
    







我已经include了jni.h






如果是c程序，要用 (*env)->  
如果是C++要用 env->  
ps:在linux下如果.c文件中用 “env->” 编译会找不到此结构，必须用“(*env)->”，或者改成.cpp文件，以 c++的方式来编译。  
以下是两者的区别：  
jni.h中  

    
    <span class="kwrd">struct</span> JNINativeInterface_;
    <span class="kwrd">struct</span> JNIEnv_;
    #ifdef __cplusplus
    typedef JNIEnv_ JNIEnv;
    <span class="preproc">#else</span>
    typedef <span class="kwrd">const</span> <span class="kwrd">struct</span> JNINativeInterface_ *JNIEnv;
    <span class="preproc">#endif</span>
    <span class="rem">/*</span>
    <span class="rem">* We use inlined functions for C++ so that programmers can write:</span>
    <span class="rem">*</span>
    <span class="rem">* env->FindClass("java/lang/String")</span>
    <span class="rem">*</span>
    <span class="rem">* in C++ rather than:</span>
    <span class="rem">*</span>
    <span class="rem">* (*env)->FindClass(env, "java/lang/String")</span>
    <span class="rem">*</span>
    <span class="rem">* in C.</span>
    <span class="rem">*/</span>
    



即C++中使用  
env->FindClass("java/lang/String")  
C中使用  
(*env)->FindClass(env, "java/lang/String")



