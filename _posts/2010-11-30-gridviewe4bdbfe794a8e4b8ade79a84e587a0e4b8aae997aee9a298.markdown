---
author: ths
comments: true
date: 2010-11-30 05:24:12+00:00
layout: post
slug: gridview%e4%bd%bf%e7%94%a8%e4%b8%ad%e7%9a%84%e5%87%a0%e4%b8%aa%e9%97%ae%e9%a2%98
title: GridView使用中的几个问题
wordpress_id: 134
categories:
- 技术
---





本文中提到的GridView的几个问题有字符串截取完美解决方案，超链接，分页。





一、Gridview中长字符串的截取





我们用Gridview是有时需要显示的内容太长，造成显示结构的混乱，故要固定长的字符串，超出范围用"…"代替，下面是实现方法：





首先定义字符串截取函数，比较简单就不解释了










    


        

[view plain](http://blog.csdn.net/tonghuashuai2009/archive/2010/03/07/5353889.aspx#)[copy to clipboard](http://blog.csdn.net/tonghuashuai2009/archive/2010/03/07/5353889.aspx#)[print](http://blog.csdn.net/tonghuashuai2009/archive/2010/03/07/5353889.aspx#)[?](http://blog.csdn.net/tonghuashuai2009/archive/2010/03/07/5353889.aspx#)


    


    


        
  1. private static void GridViewFormat(GridView ObjGridView, int IntNum)

        
  2. {

        
  3. for (int i = 0; i < ObjGridView.Rows.Count; i++)

        
  4. {

        
  5. for (int j = 0; j < ObjGridView.Columns.Count; j++)

        
  6. {

        
  7. 
        
  8. if ((ObjGridView.Rows[i].Cells[j].Text).Length > IntNum)

        
  9. {

        
  10. ObjGridView.Rows[i].Cells[j].Text = (ObjGridView.Rows[i].Cells[j].Text).Substring(0, IntNum) + "...";

        
  11. }

        
  12. }

        
  13. }

        
  14. }

    










然后在绑定数据后调用就可以了（代码中红色字体），相关代码如下：





protected void Page_Load(object sender, EventArgs e)  

     {  

       

     SqlConnection conn = new SqlConnection(ConfigurationManager.ConnectionStrings["conn"].ConnectionString);  

     conn.Open();  

     String sqlStr = "SELECT * FROM Problem";  

     SqlDataAdapter da = new SqlDataAdapter(sqlStr,conn);  

     DataSet ds = new DataSet();  

     da.Fill(ds);  

     this.ShowProblem.DataSource = ds;  

     this.ShowProblem.DataBind();  

     GridViewFormat(ShowProblem, 5);  

     conn.Close();  

     }





ps：我的GridView的id为ShowProblem 截取的字符串长度为5个。





二、Gridview中内容加超级链接，话不多说，直接上代码：





<asp:GridView ID="ShowProblem" runat="server" Width="755px" AutoGenerateColumns="False" CellPadding="3" BackColor="White" BorderColor="#CCCCCC" BorderStyle="None" BorderWidth="1px" AllowPaging="True" PageSize="20" OnPageIndexChanging="ShowProblem_PageIndexChanging" >  

     <Columns>  

     <asp:TemplateField HeaderText="问题" SortExpression="Problem">   

     <ItemStyle Width="30%" />   

     <ItemTemplate>  

     <asp:HyperLink ID="HyperLink1" runat="server" NavigateUrl ='<%# "~/detail.aspx?id="+Eval("id") %>' Text='<%# Eval("Problem").ToString().Substring(0,10)+"..." %>'></asp:HyperLink>  

     </ItemTemplate>  

     </asp:TemplateField>   

     <asp:BoundField DataField="Auther" HeaderText="提问者">  

     <ItemStyle Width="20%" />  

     </asp:BoundField>  

     <asp:BoundField DataField="NumVisite" HeaderText="查看次数">  

     <ItemStyle Width="10%" />  

     </asp:BoundField>  

     <asp:BoundField DataField="NumReply" HeaderText="回复人数">  

     <ItemStyle Width="10%" />  

     </asp:BoundField>  

     <asp:BoundField DataField="PubDate" HeaderText="发布时间" />   

     </Columns>  

     <RowStyle ForeColor="#000066" HorizontalAlign="Center" />  

     <FooterStyle BackColor="White" ForeColor="#000066" />  

     <PagerStyle BackColor="White" ForeColor="#000066" HorizontalAlign="Left" />  

     <SelectedRowStyle BackColor="#669999" Font-Bold="True" ForeColor="White" />  

     <HeaderStyle BackColor="#006699" Font-Bold="True" ForeColor="White" />  

     <EditRowStyle HorizontalAlign="Center" />  

       

     </asp:GridView>





代码中红色部分就是增加超级链接的单元格，我让"问题"列连接到详细显示页面了。





细心的朋友可能注意到了这句：Text='<%# Eval("Problem").ToString().Substring(0,10)+"..." %>'，关于这个问题我要说一下，刚才上面说了截取字符串，但是加链接后对这一列失效了，原因还没来得及找，于是只好利用Substring（）来截取了。这是一种办法，但是在使用过程中如果实际的字符小于10就会报错，这是只要用（）？（）：（）判断下就可以了，修改后的代码入下：





Text='<%# (Eval("Problem").ToString().Length > 20 ? Eval("Problem").ToString().Substring(0,10) : Eval("Problem").ToString()) +"..."%>'。





三、Gridview分页





这个问题其实挺简单，但是真正学的时候却用了我一个上午，总是出现各种各样的错误，最后找出原因，由于大部分朋友都是到网上学习，但是网上给出的很杂，有.net1的用法，有.net2.0的用法，大家知道.net1中的DataView已经被2.0中的GridView替代，有些初学者就不注意，用.net1的代码复制到vs2005中导致出错，更有甚者是用.net1的签名用2.0的函数体，这就造成未找到定义的错误。实际中需要注意的问题有两个，一个是在html页面，应该这么写：





<asp:GridView ID="ShowProblem" runat="server" AutoGenerateColumns="False" CellPadding="3" AllowPaging="True" PageSize="20" OnPageIndexChanging="ShowProblem_PageIndexChanging" >





值得注意的是代码中红色部分，不要写错，然后后台页中应该这么写：





protected void ShowProblem_PageIndexChanging(object sender, GridViewPageEventArgs e)  

     {  

     this.ShowProblem.PageIndex = e.NewPageIndex;  

     this.ShowProblem.DataBind();  

     }





注意红色部分，这是vs2005的写法，2003的写法就不同了。



