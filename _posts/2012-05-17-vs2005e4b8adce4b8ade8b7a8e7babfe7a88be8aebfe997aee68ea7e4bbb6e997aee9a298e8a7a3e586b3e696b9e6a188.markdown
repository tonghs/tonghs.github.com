---
author: ths
comments: true
date: 2012-05-17 08:44:00+00:00
layout: post
slug: vs2005%e4%b8%adc%e4%b8%ad%e8%b7%a8%e7%ba%bf%e7%a8%8b%e8%ae%bf%e9%97%ae%e6%8e%a7%e4%bb%b6%e9%97%ae%e9%a2%98%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88
title: VS2005中,C#中跨线程访问控件问题解决方案
wordpress_id: 747
categories:
- 技术
tags:
- c
- 多线程
---

最近我在做一个项目,遇到了跨线程要去访问页面控件.但是总是提示出错,不能在其它线程中修改创建控件的线程的控件的值,后来采用了匿名代理,结果很轻松地解决了.解决过程如下:  
首先在窗体上,创建一个listbox,lable. 
    
    <span style="color: #0000ff">using</span> System;
    <span style="color: #0000ff">using</span> System.Collections.Generic;
    <span style="color: #0000ff">using</span> System.ComponentModel;
    <span style="color: #0000ff">using</span> System.Data;
    <span style="color: #0000ff">using</span> System.Drawing;
    <span style="color: #0000ff">using</span> System.Text;
    <span style="color: #0000ff">using</span> System.Windows.Forms;
    <span style="color: #0000ff">using</span> System.Threading;
    <span style="color: #0000ff">namespace</span> AccessControl
    {
        <span style="color: #0000ff">public</span> partial <span style="color: #0000ff">class</span> Form1 : Form
        {      
            <span style="color: #0000ff">public</span> Form1()
            {
                InitializeComponent();
            }
            <span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span> Form1_Load(<span style="color: #0000ff">object</span> sender, EventArgs e)
            {  
                Thread newthread = <span style="color: #0000ff">new</span> Thread(<span style="color: #0000ff">new</span> ThreadStart(BackgroundProcess));
                newthread.Start();         
            }
            <span style="color: #808080">/// <summary> </span>
            <span style="color: #808080">/// 定义一个代理 </span>
            <span style="color: #808080">/// </summary> </span>
            <span style="color: #0000ff">private</span> <span style="color: #0000ff">delegate</span> <span style="color: #0000ff">void</span> CrossThreadOperationControl();
            <span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span> BackgroundProcess()
            {
                <span style="color: #008000">// 将代理实例化为一个匿名代理 </span>
                CrossThreadOperationControl CrossDelete = <span style="color: #0000ff">delegate</span>()          
                {            
                    <span style="color: #0000ff">int</span> i = 1;
                    <span style="color: #0000ff">while</span> (i<5)
                    {
                       <span style="color: #008000">// 向列表框增加一个项目 </span>
                        listBox1.Items.Add("<span style="color: #8b0000">Item </span>" + i.ToString());                    
                        i++;
                    }
                    label1.Text = "<span style="color: #8b0000">我在新线程里访问这个lable!</span>";
                    listBox1.Items.Add(label1.Text);
                }  ;
                listBox1.Invoke(CrossDelete);           
            }       
        }
    }

希望这个小技巧能够对你的的学习和工作有所帮助.若有更好的办法来解决跨线程访问控件的问题,不防也拿出来大家分享一下.



