---
author: ths
comments: true
date: 2010-12-14 05:00:00+00:00
layout: post
slug: datetimepicker%e8%83%8c%e6%99%af%e9%97%ae%e9%a2%98%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%b3%95
title: DateTimePicker背景问题的解决方法
wordpress_id: 313
categories:
- 技术
tags:
- c
- visual studio
---

写在前面：DateTimePicker控件没有BackColor属性，这是十分讨厌的事情，只有自己写一个BackColor的功能，写的时候，用不了OnPaint方法，只能使用WndProc(ref Message m)来捕捉系统消息再画。





效果图





![](http://www.myfirm.cn/UpLoadFiles/20080328222723.gif)





下面就是一个自定义的DateTimePicker控件，它就拥有BackColor属性，颜色是GreenYellow，要实现这一功能，其实也是相当的简单，只要在处理系统消息时增加一个图形绘制的功能。









源代码





新建一个UserControl控件，然后将继承修改为DateTimePicker，再注释了AutoScaleMode方法，如//this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;就可以了。





0x0014表示一个数字，在C++平台上面应该是叫WM_ERASEBKGND，这个消息主要用于绘制背景。





public partial class DateTimePickerMyFirm : DateTimePicker





{





public DateTimePickerMyFirm()





{





InitializeComponent();





}









protected override void WndProc(ref Message m)





{





base.WndProc(ref m);





switch (m.Msg)





{





case (int)0x0014:/* WM_ERASEBKGND */





base.WndProc(ref m);





Graphics g = Graphics.FromHdc(m.WParam);





//画背景





g.FillRectangle(new SolidBrush(Color.GreenYellow),





ClientRectangle);









g.Dispose();





break;





default:





break;





}





}





}



